version: '3.8'
services:
  caddy:
    image: caddy:latest
    ports: ["80:80", "443:443"]
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile
      - caddy_data:/data
    environment:
      - DOMAIN=${DOMAIN:-yourdomain.com}
    restart: always
  check-auth:
    image: python:3.9-slim
    command: sh -c "pip install requests && python /check.py"
    volumes:
      - ./check.py:/check.py
  frps:
    image: snowdreamtech/frps:latest
    ports:
      - "7000:7000" # Tunnel Connection
      - "7500:7500" # Admin Panel
      - "8000-9999:8000-9999"
    volumes:
      - ./frps.toml.template:/etc/frp/frps.toml.template
      - ./frps-entrypoint.sh:/frps-entrypoint.sh
    entrypoint: ["/bin/sh", "/frps-entrypoint.sh"]
    environment:
      - DOMAIN=${DOMAIN:-yourdomain.com}
    restart: always
volumes:
  caddy_data: